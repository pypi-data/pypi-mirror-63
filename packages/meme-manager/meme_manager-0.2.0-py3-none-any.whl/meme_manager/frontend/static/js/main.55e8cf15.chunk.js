(this["webpackJsonpmeme-manager"]=this["webpackJsonpmeme-manager"]||[]).push([[0],{154:function(e,t,a){e.exports=a(306)},305:function(e,t,a){},306:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(5),c=a.n(o),l=a(21),s=a.n(l),i=a(94),u=a(82),p=a(33),m=a(28),g=a(314),d=a(311),f=a(309),v=a(54),h=a(30),b=a(26),E=a(83),O=a(92),y=a(84),j=a(53),S=a(93),w=a(310),C=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(O.a)(this,Object(y.a)(t).call(this,e))).handleFileChoose=function(e){var t=e.target.files[0];console.log("Upload: recv file: %o",{file:t}),a.setState({file:t}),a.props.onChange(t)},a.state={file:a.props.value},a}return Object(S.a)(t,e),Object(j.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e){return console.log("Upload getDerivedStateFromProps: %o",{nextProps:e}),"value"in e?{file:e.value||void 0}:null}}]),Object(j.a)(t,[{key:"render",value:function(){var e=this.state.file;return r.a.createElement("div",null,void 0===e?r.a.createElement(w.a,{type:"file",onChange:this.handleFileChoose}):r.a.createElement("img",{src:URL.createObjectURL(e),alt:e.name,style:{width:"300px"}}))}}]),t}(r.a.Component),k=a(66),x=a(9),I=function(e){function t(e){var a;return Object(E.a)(this,t),(a=Object(O.a)(this,Object(y.a)(t).call(this,e))).handleOptionRemove=function(e){var t=[].concat(Object(k.a)(a.state.tags.slice(0,e)),Object(k.a)(a.state.tags.slice(e+1)));a.triggerChange(t)},a.handleOptionAdd=function(){var e=[].concat(Object(k.a)(a.state.tags),[""]);a.triggerChange(e)},a.handleInputChange=function(e,t){var n=t.target.value||"",r=Object(k.a)(a.state.tags);r[e]=n,a.triggerChange(r)},a.triggerChange=function(e){a.setState({tags:e}),a.props.onChange(e)},a.state={tags:a.props.value||[""]},a}return Object(S.a)(t,e),Object(j.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e){return console.log("TagsInput getDerivedStateFromProps: %o",{nextProps:e}),"value"in e?{tags:e.value||[""]}:null}}]),Object(j.a)(t,[{key:"render",value:function(){var e=this,t=this.state.tags,a=t.map((function(a,n){return r.a.createElement("div",{key:n},r.a.createElement(w.a,{value:a,placeholder:"Tag",style:{width:"80%"},onChange:function(t){e.handleInputChange(n,t)}}),t.length>1?r.a.createElement(x.a,{className:"dynamic-delete-button",type:"minus-circle-o",disabled:1===t.length,onClick:function(){return e.handleOptionRemove(n)}}):null)}));return r.a.createElement("div",null,a,r.a.createElement(b.a,{type:"dashed",onClick:this.handleOptionAdd},r.a.createElement(x.a,{type:"plus"})," Add Select Item"))}}]),t}(r.a.Component);function D(e){var t=e.form,a=e.onSubmit;return r.a.createElement(f.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:16}}},{onSubmit:function(e){e.preventDefault(),t.validateFields(function(){var e=Object(p.a)(s.a.mark((function e(n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?console.error(n):(a(r),t.resetFields());case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}}),r.a.createElement(f.a.Item,{label:"\u56fe\u7247"},t.getFieldDecorator("image",{rules:[{required:!0,message:"\u5fc5\u987b\u9009\u62e9\u4e00\u4e2a\u56fe\u7247"}]})(r.a.createElement(C,null))),r.a.createElement(f.a.Item,{label:"\u6807\u7b7e"},t.getFieldDecorator("tags",{initialValue:[""],rules:[{required:!0,message:"\u5fc5\u987b\u8f93\u5165\u6807\u7b7e"}]})(r.a.createElement(I,null))),r.a.createElement(f.a.Item,{wrapperCol:{xs:{span:24,offset:0},sm:{span:22,offset:4}}},r.a.createElement(b.a,{type:"primary",htmlType:"submit"},"\u63d0\u4ea4")))}var A=a(312);function F(e){var t=e.buttonItem,a=e.title,o=e.WrappedForm,c=e.onSubmit,l=Object(n.useState)(!1),s=Object(m.a)(l,2),i=s[0],u=s[1];return r.a.createElement("div",null,r.a.createElement(t.type,Object.assign({},t.props,{onClick:function(){u(!0)}})),r.a.createElement(A.a,{title:a,visible:i,onCancel:function(){u(!1)},footer:null},r.a.createElement(o,{onSubmit:function(e){u(!1),c(e)}})))}var T=a(63),P=T.a.Option;function z(e){var t=e.initialKey,a=e.initialValue,o=e.onSearch,c=Object(n.useState)(t),l=Object(m.a)(c,2),s=l[0],i=l[1];return r.a.createElement(w.a.Group,{compact:!0},r.a.createElement(T.a,{value:s,style:{width:"10%"},onSelect:i},r.a.createElement(P,{value:"tag"},"\u6807\u7b7e")),r.a.createElement(w.a.Search,{style:{width:"50%"},defaultValue:a,onSearch:function(e){return o(s,e)},enterButton:!0}))}function N(e){var t=e.searchField,a=e.onImageAdd,n=e.onSearch,o=f.a.create()(D);return r.a.createElement(v.a,null,r.a.createElement(h.a,{span:18},r.a.createElement(z,{initialKey:t.key,initialValue:t.value,onSearch:n})),r.a.createElement(h.a,{span:6},r.a.createElement(F,{buttonItem:r.a.createElement(b.a,{type:"primary"},"\u6dfb\u52a0"),title:"\u6dfb\u52a0\u56fe\u7247",WrappedForm:o,onSubmit:a})))}var R=a(307),_=a(308),B=a(313),M=a(315),W=A.a.confirm;function J(e){var t=e.tags,a=e.onTagDelete;return r.a.createElement("div",null,t.map((function(e){return r.a.createElement(B.a,{key:e,overlay:r.a.createElement(_.a,null,r.a.createElement(_.a.Item,null,r.a.createElement("div",{onClick:function(){return t=e,void W({title:"\u786e\u5b9a\u5220\u9664\u8be5\u6807\u7b7e\uff1f",content:"\u6ce8\u610f\uff01\u6807\u7b7e\u5220\u9664\u540e\u65e0\u6cd5\u6062\u590d\uff01",onOk:function(){a(t)},onCancel:function(){}});var t}},"\u5220\u9664\u6807\u7b7e"))),trigger:["contextMenu"],onContextMenu:function(e){return e.stopPropagation()}},r.a.createElement(M.a,{className:"tag"},e))})))}function K(e){var t=e.form,a=e.onSubmit;return r.a.createElement(f.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:16}}},{onSubmit:function(e){e.preventDefault(),t.validateFields(function(){var e=Object(p.a)(s.a.mark((function e(n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?console.error(n):(a(r.tags),t.resetFields());case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}}),r.a.createElement(f.a.Item,{label:"\u6807\u7b7e"},t.getFieldDecorator("tags",{initialValue:[""],rules:[{required:!0,message:"\u5fc5\u987b\u8f93\u5165\u6807\u7b7e"}]})(r.a.createElement(I,null))),r.a.createElement(f.a.Item,{wrapperCol:{xs:{span:24,offset:0},sm:{span:22,offset:4}}},r.a.createElement(b.a,{type:"primary",htmlType:"submit"},"\u63d0\u4ea4")))}var U={BACKEND_PREFIX:"http://127.0.0.1:5000"},V=A.a.confirm,q=U.BACKEND_PREFIX,L=R.a.Meta;function X(e){var t=e.metadata,a=e.onImageDelete,n=e.onTagsAdd,o=e.onTagDelete,c=f.a.create()(K),l=r.a.createElement(_.a,null,r.a.createElement(_.a.Item,null,r.a.createElement("div",{onClick:function(){V({title:"\u786e\u5b9a\u5220\u9664\u8be5\u56fe\u7247\uff1f",content:"\u6ce8\u610f\uff01\u56fe\u7247\u5220\u9664\u540e\u65e0\u6cd5\u6062\u590d\uff01",onOk:function(){a(t.id)},onCancel:function(){}})}},"\u5220\u9664\u56fe\u7247")),r.a.createElement(_.a.Item,null,r.a.createElement(F,{buttonItem:r.a.createElement("div",null,"\u6dfb\u52a0\u6807\u7b7e"),title:"\u6dfb\u52a0\u6807\u7b7e",WrappedForm:c,onSubmit:function(e){return n(t.id,e)}})));return r.a.createElement(B.a,{overlay:l,trigger:["contextMenu"]},r.a.createElement(R.a,{hoverable:!0,style:{width:240},cover:r.a.createElement("img",{src:"".concat(q,"/api/images/?id=").concat(t.id),alt:"img-".concat(t.id)})},r.a.createElement(L,{description:r.a.createElement(J,{tags:t.tags,onTagDelete:function(e){return o(t.id,e)}})})))}function G(e){var t=e.imageMetaDatas,a=e.onImageDelete,n=e.onTagsAdd,o=e.onTagDelete;return r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},t.map((function(e){return r.a.createElement(X,{key:e.id,metadata:e,onImageDelete:a,onTagsAdd:n,onTagDelete:o})})))}function H(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new URL(e),n=0,r=Object.entries(t);n<r.length;n++){var o=Object(m.a)(r[n],2),c=o[0],l=o[1];a.searchParams.append(c,l)}return console.log("get: %o",{urlO:a}),fetch(a.href,{mode:"cors",credentials:"include"})}function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log("post: %o",{url:e,body:t}),fetch(e,{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"}),mode:"cors",credentials:"include"})}function Q(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new FormData,n=0,r=Object.entries(t);n<r.length;n++){var o=Object(m.a)(r[n],2),c=o[0],l=o[1];a.append(c,l)}return console.log("postForm: %o",{url:e,formData:a}),fetch(e,{method:"POST",body:a,mode:"cors",credentials:"include"})}var Y=U.BACKEND_PREFIX;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(305);c.a.render(r.a.createElement((function(){var e=Object(n.useState)([]),t=Object(m.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)({current:1,pageSize:20,total:null}),l=Object(m.a)(c,2),f=l[0],v=l[1],h=Object(n.useState)({key:"tag",value:""}),b=Object(m.a)(h,2),E=b[0],O=b[1],y=function(){var e=Object(p.a)(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App: handle refresh"),t=Object(u.a)({page:f.current,per_page:f.pageSize},E.key,E.value),e.next=4,H("".concat(Y,"/api/images/"),t);case 4:if(200===(a=e.sent).status){e.next=9;break}return g.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u5237\u65b0\u5931\u8d25"),console.error("Error: %o",{resp:a}),e.abrupt("return");case 9:return e.next=11,a.json();case 11:return n=e.sent,console.log("App: receive resp: %o",{respJSON:n}),o(n.data),v(Object(i.a)({},f,{current:n.pagination.page,pageSize:n.pagination.per_page,total:n.pagination.total})),e.abrupt("return");case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){y()}),[f.current,f.pageSize,E]);var j=function(){var e=Object(p.a)(s.a.mark((function e(t){var a,n,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleImageAdd: %o",{values:t}),a=t.image,n=a.type.split("/")[1],r={image:a,metadata:JSON.stringify({img_type:n,tags:t.tags})},console.log("App post body: %o",r),e.next=7,Q("".concat(Y,"/api/images/add"),r);case 7:if(200===(o=e.sent).status){e.next=12;break}return g.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u6dfb\u52a0\u56fe\u7247\u5931\u8d25"),console.error("Error: %o",{resp:o}),e.abrupt("return");case 12:return g.a.success("\u6dfb\u52a0\u56fe\u7247\u6210\u529f"),console.log("Success: %o",{resp:o}),y(),e.abrupt("return");case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleImageDelete: %o",{id:t}),e.next=3,H("".concat(Y,"/api/images/delete"),{id:t});case 3:if(200===(a=e.sent).status){e.next=8;break}return g.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u5220\u9664\u56fe\u7247\u5931\u8d25"),console.error("Error: %o",{resp:a}),e.abrupt("return");case 8:return g.a.success("\u5220\u9664\u56fe\u7247\u6210\u529f"),console.log("Success: %o",{resp:a}),y(),e.abrupt("return");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(p.a)(s.a.mark((function e(t,a){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleTagsAdd: %o",{imageId:t,tags:a}),n={image_id:t,tags:a},console.log("App POST body: %o",n),e.next=5,$("".concat(Y,"/api/tags/add"),n);case 5:if(200===(r=e.sent).status){e.next=10;break}return g.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u6dfb\u52a0\u6807\u7b7e\u5931\u8d25"),console.error("Error: %o",{resp:r}),e.abrupt("return");case 10:return g.a.success("\u6dfb\u52a0\u6807\u7b7e\u6210\u529f"),console.log("Success: %o",{resp:r}),y(),e.abrupt("return");case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),C=function(){var e=Object(p.a)(s.a.mark((function e(t,a){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleTagDelete: %o",{imageId:t,tag:a}),n={image_id:t,tag:a},console.log("App POST body: %o",n),e.next=5,$("".concat(Y,"/api/tags/delete"),n);case 5:if(200===(r=e.sent).status){e.next=10;break}return g.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u5220\u9664\u6807\u7b7e\u5931\u8d25"),console.error("Error: %o",{resp:r}),e.abrupt("return");case 10:return g.a.success("\u5220\u9664\u6807\u7b7e\u6210\u529f"),console.log("Success: %o",{resp:r}),y(),e.abrupt("return");case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement(N,{searchField:E,onImageAdd:j,onSearch:function(e,t){return O({key:e,value:t})}}),r.a.createElement(G,{imageMetaDatas:a,onImageDelete:S,onTagsAdd:w,onTagDelete:C}),r.a.createElement(d.a,Object.assign({},f,{showSizeChanger:!0,pageSizeOptions:["20","50","100","200"],onChange:function(e,t){return v(Object(i.a)({},f,{current:e,pageSize:t}))},onShowSizeChange:function(e,t){return v(Object(i.a)({},f,{current:e,pageSize:t}))}})))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[154,1,2]]]);
//# sourceMappingURL=main.55e8cf15.chunk.js.map