(this["webpackJsonpmeme-manager"]=this["webpackJsonpmeme-manager"]||[]).push([[0],{150:function(e,t,a){e.exports=a(302)},301:function(e,t,a){},302:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(5),c=a.n(o),l=a(21),i=a.n(l),s=a(47),u=a(81),p=a(32),m=a(26),d=a(311),g=a(308),f=a(306),v=a(27),h=a(82),b=a(90),E=a(83),y=a(53),O=a(91),x=a(307),j=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(E.a)(t).call(this,e))).handleFileChoose=function(e){var t=e.target.files[0];console.log("Upload: recv file: %o",{file:t}),a.setState({file:t}),a.props.onChange(t)},a.state={file:a.props.value},a}return Object(O.a)(t,e),Object(y.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e){return console.log("Upload getDerivedStateFromProps: %o",{nextProps:e}),"value"in e?{file:e.value||void 0}:null}}]),Object(y.a)(t,[{key:"render",value:function(){var e=this.state.file;return r.a.createElement("div",null,void 0===e?r.a.createElement(x.a,{type:"file",onChange:this.handleFileChoose}):r.a.createElement("img",{src:URL.createObjectURL(e),alt:e.name,style:{width:"300px"}}))}}]),t}(r.a.Component),S=a(65),w=a(9),C=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(b.a)(this,Object(E.a)(t).call(this,e))).handleOptionRemove=function(e){var t=[].concat(Object(S.a)(a.state.tags.slice(0,e)),Object(S.a)(a.state.tags.slice(e+1)));a.triggerChange(t)},a.handleOptionAdd=function(){var e=[].concat(Object(S.a)(a.state.tags),[""]);a.triggerChange(e)},a.handleInputChange=function(e,t){var n=t.target.value||"",r=Object(S.a)(a.state.tags);r[e]=n,a.triggerChange(r)},a.triggerChange=function(e){a.setState({tags:e}),a.props.onChange(e)},a.state={tags:a.props.value||[""]},a}return Object(O.a)(t,e),Object(y.a)(t,null,[{key:"getDerivedStateFromProps",value:function(e){return console.log("TagsInput getDerivedStateFromProps: %o",{nextProps:e}),"value"in e?{tags:e.value||[""]}:null}}]),Object(y.a)(t,[{key:"render",value:function(){var e=this,t=this.state.tags,a=t.map((function(a,n){return r.a.createElement("div",{key:n},r.a.createElement(x.a,{value:a,placeholder:"Tag",style:{width:"80%"},onChange:function(t){e.handleInputChange(n,t)}}),t.length>1?r.a.createElement(w.a,{className:"dynamic-delete-button",type:"minus-circle-o",disabled:1===t.length,onClick:function(){return e.handleOptionRemove(n)}}):null)}));return r.a.createElement("div",null,a,r.a.createElement(v.a,{type:"dashed",onClick:this.handleOptionAdd},r.a.createElement(w.a,{type:"plus"})," Add Select Item"))}}]),t}(r.a.Component);function k(e){var t=e.form,a=e.onSubmit;return r.a.createElement(f.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:16}}},{onSubmit:function(e){e.preventDefault(),t.validateFields(function(){var e=Object(p.a)(i.a.mark((function e(n,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?console.error(n):(a(r),t.resetFields());case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}}),r.a.createElement(f.a.Item,{label:"\u56fe\u7247"},t.getFieldDecorator("image",{rules:[{required:!0,message:"\u5fc5\u987b\u9009\u62e9\u4e00\u4e2a\u56fe\u7247"}]})(r.a.createElement(j,null))),r.a.createElement(f.a.Item,{label:"\u6807\u7b7e"},t.getFieldDecorator("tags",{initialValue:[""],rules:[{required:!0,message:"\u5fc5\u987b\u8f93\u5165\u6807\u7b7e"}]})(r.a.createElement(C,null))),r.a.createElement(f.a.Item,{wrapperCol:{xs:{span:24,offset:0},sm:{span:22,offset:4}}},r.a.createElement(v.a,{type:"primary",htmlType:"submit"},"\u63d0\u4ea4")))}var I=a(309);function D(e){var t=e.buttonItem,a=e.title,o=e.WrappedForm,c=e.onSubmit,l=Object(n.useState)(!1),i=Object(m.a)(l,2),s=i[0],u=i[1];return r.a.createElement("div",null,r.a.createElement(t.type,Object.assign({},t.props,{onClick:function(){u(!0)}})),r.a.createElement(I.a,{title:a,visible:s,onCancel:function(){u(!1)},footer:null},r.a.createElement(o,{onSubmit:function(e){u(!1),c(e)}})))}var A=a(62),F=A.a.Option;function T(e){var t=e.initialKey,a=e.initialValue,o=e.onSearch,c=e.onReset,l=Object(n.useState)(t),i=Object(m.a)(l,2),s=i[0],u=i[1],p=Object(n.useState)(a),d=Object(m.a)(p,2),g=d[0],f=d[1];return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(A.a,{value:s,onSelect:u},r.a.createElement(F,{value:"tag"},"\u6807\u7b7e")),r.a.createElement(x.a.Search,{value:g,onChange:function(e){return f(e.target.value)},onSearch:function(e){return o(s,e)},enterButton:!0}),r.a.createElement("div",{style:{marginLeft:"10px"}},r.a.createElement(v.a,{type:"primary",onClick:function(){f(""),c()}},"\u91cd\u7f6e")))}function P(e){var t=e.searchField,a=e.onImageAdd,n=e.onSearch,o=e.onReset,c=f.a.create()(k);return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{flexGrow:"1"}},r.a.createElement(T,{initialKey:t.key,initialValue:t.value,onSearch:n,onReset:o})),r.a.createElement("div",{style:{marginLeft:"100px"}},r.a.createElement(D,{buttonItem:r.a.createElement(v.a,{type:"primary"},"\u6dfb\u52a0"),title:"\u6dfb\u52a0\u56fe\u7247",WrappedForm:c,onSubmit:a})))}var R=a(304),z=a(305),B=a(310),N=I.a.confirm;function W(e){var t=e.tags,a=e.onTagDelete;return r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},t.map((function(e){return r.a.createElement(B.a,{key:e,overlay:r.a.createElement(z.a,null,r.a.createElement(z.a.Item,null,r.a.createElement("div",{onClick:function(){return t=e,void N({title:"\u786e\u5b9a\u5220\u9664\u8be5\u6807\u7b7e\uff1f",content:"\u6ce8\u610f\uff01\u6807\u7b7e\u5220\u9664\u540e\u65e0\u6cd5\u6062\u590d\uff01",onOk:function(){a(t)},onCancel:function(){}});var t}},"\u5220\u9664\u6807\u7b7e"))),trigger:["contextMenu"],onContextMenu:function(e){return e.stopPropagation()}},r.a.createElement("div",{className:"tag"},e))})))}function _(e){var t=e.form,a=e.onSubmit;return r.a.createElement(f.a,Object.assign({},{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:16}}},{onSubmit:function(e){e.preventDefault(),t.validateFields(function(){var e=Object(p.a)(i.a.mark((function e(n,r){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?console.error(n):(a(r.tags),t.resetFields());case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}}),r.a.createElement(f.a.Item,{label:"\u6807\u7b7e"},t.getFieldDecorator("tags",{initialValue:[""],rules:[{required:!0,message:"\u5fc5\u987b\u8f93\u5165\u6807\u7b7e"}]})(r.a.createElement(C,null))),r.a.createElement(f.a.Item,{wrapperCol:{xs:{span:24,offset:0},sm:{span:22,offset:4}}},r.a.createElement(v.a,{type:"primary",htmlType:"submit"},"\u63d0\u4ea4")))}var M={BACKEND_PREFIX:"http://127.0.0.1:5000"},J=I.a.confirm,K=M.BACKEND_PREFIX;R.a.Meta;function L(e){var t=e.metadata,a=e.onImageDelete,n=e.onTagsAdd,o=e.onTagDelete,c="".concat(K,"/api/images/?id=").concat(t.id),l=f.a.create()(_),i=r.a.createElement(z.a,null,r.a.createElement(z.a.Item,null,r.a.createElement("div",{onClick:function(){window.open(c)}},"\u67e5\u770b\u56fe\u7247")),r.a.createElement(z.a.Item,null,r.a.createElement(D,{buttonItem:r.a.createElement("div",null,"\u6dfb\u52a0\u6807\u7b7e"),title:"\u6dfb\u52a0\u6807\u7b7e",WrappedForm:l,onSubmit:function(e){return n(t.id,e)}})),r.a.createElement(z.a.Item,null,r.a.createElement("div",{onClick:function(){J({title:"\u786e\u5b9a\u5220\u9664\u8be5\u56fe\u7247\uff1f",content:"\u6ce8\u610f\uff01\u56fe\u7247\u5220\u9664\u540e\u65e0\u6cd5\u6062\u590d\uff01",onOk:function(){a(t.id)},onCancel:function(){}})}},"\u5220\u9664\u56fe\u7247")));return r.a.createElement(B.a,{overlay:i,trigger:["contextMenu"]},r.a.createElement("div",{className:"imageBox"},r.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignContent:"center",width:"250px",height:"250px",overflow:"hidden"}},r.a.createElement("img",{style:{maxWidth:"100%",margin:"auto"},src:c,alt:"img-".concat(t.id)})),r.a.createElement("div",{style:{width:"250px",minHeight:"50px",overflow:"hidden"}},r.a.createElement(W,{tags:t.tags,onTagDelete:function(e){return o(t.id,e)}}))))}function U(e){var t=e.imageMetaDatas,a=e.onImageDelete,n=e.onTagsAdd,o=e.onTagDelete;return r.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",backgroundColor:"white",boxShadow:"2px 2px 5px #a0a0a0"}},t.map((function(e){return r.a.createElement(L,{key:e.id,metadata:e,onImageDelete:a,onTagsAdd:n,onTagDelete:o})})))}function V(){return r.a.createElement("div",{style:{width:"100%",height:"100px",backgroundColor:"#999999",textAlign:"center"}},"Footer")}function q(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new URL(e),n=0,r=Object.entries(t);n<r.length;n++){var o=Object(m.a)(r[n],2),c=o[0],l=o[1];a.searchParams.append(c,l)}return console.log("get: %o",{urlO:a}),fetch(a.href,{mode:"cors",credentials:"include"})}function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return console.log("post: %o",{url:e,body:t}),fetch(e,{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"}),mode:"cors",credentials:"include"})}function X(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new FormData,n=0,r=Object.entries(t);n<r.length;n++){var o=Object(m.a)(r[n],2),c=o[0],l=o[1];a.append(c,l)}return console.log("postForm: %o",{url:e,formData:a}),fetch(e,{method:"POST",body:a,mode:"cors",credentials:"include"})}var G=M.BACKEND_PREFIX;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(301);c.a.render(r.a.createElement((function(){var e=Object(n.useState)([]),t=Object(m.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)({current:1,pageSize:20,total:null}),l=Object(m.a)(c,2),f=l[0],v=l[1],h=Object(n.useState)({key:"tag",value:""}),b=Object(m.a)(h,2),E=b[0],y=b[1],O=function(){var e=Object(p.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App: handle refresh"),t=Object(u.a)({page:f.current,per_page:f.pageSize},E.key,E.value),e.next=4,q("".concat(G,"/api/images/"),t);case 4:if(200===(a=e.sent).status){e.next=9;break}return d.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u5237\u65b0\u5931\u8d25"),console.error("Error: %o",{resp:a}),e.abrupt("return");case 9:return e.next=11,a.json();case 11:return n=e.sent,console.log("App: receive resp: %o",{respJSON:n}),o(n.data),v(Object(s.a)({},f,{current:n.pagination.page,pageSize:n.pagination.per_page,total:n.pagination.total})),e.abrupt("return");case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(n.useEffect)((function(){O()}),[f.current,f.pageSize,E]);var x=function(){var e=Object(p.a)(i.a.mark((function e(t){var a,n,r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleImageAdd: %o",{values:t}),a=t.image,n=a.type.split("/")[1],r={image:a,metadata:JSON.stringify({img_type:n,tags:t.tags})},console.log("App post body: %o",r),e.next=7,X("".concat(G,"/api/images/add"),r);case 7:if(200===(o=e.sent).status){e.next=12;break}return d.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u6dfb\u52a0\u56fe\u7247\u5931\u8d25"),console.error("Error: %o",{resp:o}),e.abrupt("return");case 12:return d.a.success("\u6dfb\u52a0\u56fe\u7247\u6210\u529f"),console.log("Success: %o",{resp:o}),O(),e.abrupt("return");case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(p.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleImageDelete: %o",{id:t}),e.next=3,q("".concat(G,"/api/images/delete"),{id:t});case 3:if(200===(a=e.sent).status){e.next=8;break}return d.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u5220\u9664\u56fe\u7247\u5931\u8d25"),console.error("Error: %o",{resp:a}),e.abrupt("return");case 8:return d.a.success("\u5220\u9664\u56fe\u7247\u6210\u529f"),console.log("Success: %o",{resp:a}),O(),e.abrupt("return");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleTagsAdd: %o",{imageId:t,tags:a}),n={image_id:t,tags:a},console.log("App POST body: %o",n),e.next=5,H("".concat(G,"/api/tags/add"),n);case 5:if(200===(r=e.sent).status){e.next=10;break}return d.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u6dfb\u52a0\u6807\u7b7e\u5931\u8d25"),console.error("Error: %o",{resp:r}),e.abrupt("return");case 10:return d.a.success("\u6dfb\u52a0\u6807\u7b7e\u6210\u529f"),console.log("Success: %o",{resp:r}),O(),e.abrupt("return");case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),w=function(){var e=Object(p.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("App handleTagDelete: %o",{imageId:t,tag:a}),n={image_id:t,tag:a},console.log("App POST body: %o",n),e.next=5,H("".concat(G,"/api/tags/delete"),n);case 5:if(200===(r=e.sent).status){e.next=10;break}return d.a.error("\u7f51\u7edc\u5f02\u5e38\uff0c\u5220\u9664\u6807\u7b7e\u5931\u8d25"),console.error("Error: %o",{resp:r}),e.abrupt("return");case 10:return d.a.success("\u5220\u9664\u6807\u7b7e\u6210\u529f"),console.log("Success: %o",{resp:r}),O(),e.abrupt("return");case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100vh",backgroundColor:"#eeeeee"}},r.a.createElement("div",{style:{flexGrow:"1",maxWidth:"1010px"}},r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement(P,{searchField:E,onImageAdd:x,onSearch:function(e,t){v(Object(s.a)({},f,{current:1})),y({key:e,value:t})},onReset:function(){y(Object(s.a)({},E,{value:""})),v(Object(s.a)({},f,{current:1}))}})),r.a.createElement(U,{imageMetaDatas:a,onImageDelete:j,onTagsAdd:S,onTagDelete:w}),r.a.createElement("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px",marginBottom:"20px"}},r.a.createElement(g.a,Object.assign({},f,{showSizeChanger:!0,pageSizeOptions:["20","50","100","200"],onChange:function(e,t){return v(Object(s.a)({},f,{current:e,pageSize:t}))},onShowSizeChange:function(e,t){return v(Object(s.a)({},f,{current:e,pageSize:t}))}})))),r.a.createElement(V,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[150,1,2]]]);
//# sourceMappingURL=main.7cb99c79.chunk.js.map