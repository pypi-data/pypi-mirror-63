(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{118:function(e,t,n){},119:function(e,t,n){},120:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(40),i=n.n(o),s=(n(47),n(9)),c=n(10),l=n(12),u=n(11),d=n(13),h=(n(48),function(e){function t(){var e,n;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).onChange=function(e){n.props.onNetworkSelected(e.target.value)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"renderOptions",value:function(){return this.props.networks.map((function(e){return a.a.createElement("option",{key:e.id,value:e.id},e.name)}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"Header"},a.a.createElement("div",{className:"top"},a.a.createElement("div",{className:"left"},a.a.createElement("span",{className:"h1"},"Thomas"),"\xa0 A Bayesian Network viewer."),a.a.createElement("div",{className:"right"},a.a.createElement("a",{href:"https://github.com/mellesies/thomas-app"},"Github"))),a.a.createElement("select",{onChange:this.onChange},this.renderOptions()))}}]),t}(r.Component)),f=(n(49),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return a.a.createElement("div",{className:"Footer"},"Copyright \xa9 2020 Melle Sieswerda. All rights reserved.")}}]),t}(r.Component)),p=n(21),g=n(7),v=function(e){function t(e){var n;Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).onDragMove=function(e){var t=e.target.x(),r=e.target.y();n.setPosition(t,r),n.props.onDragMove&&n.props.onDragMove(n.RV,t,r)},n.onDragEnd=function(e){var t=e.target.x(),r=e.target.y();n.props.onDragEnd&&n.props.onDragEnd(n.RV,t,r)},n.onStateToggled=function(e){n.props.onStateToggled&&n.props.onStateToggled(n.RV,e)},n.RV=e.node.RV,n.titleHeight=15,n.stateOffset=8,n.stateHeight=14,n.statePadding=2,n.width=180,n.height=n.computeHeight();var r=e.node.position[0],a=e.node.position[1];return n.setPosition(r,a),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"createStates",value:function(e,t,n){var r=this,o=this.width,i=o-70-55;return e.states.map((function(e,s){var c=r.titleHeight+r.stateOffset+s*r.stateHeight,l="...",u=0,d="#003366";return n&&n===e&&(d="#00BCCC"),t&&(l=(100*t[e]).toFixed(2)+"%",u=1+i*t[e]),a.a.createElement(g.Group,{key:e,y:c,onDblClick:function(t){return r.onStateToggled(e)}},a.a.createElement(g.Label,null,a.a.createElement(g.Tag,null),a.a.createElement(g.Text,{text:e,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,wrap:"none",ellipsis:"ellipsis",width:70})),a.a.createElement(g.Rect,{x:70,y:1,width:u,height:r.stateHeight-2,fill:d}),a.a.createElement(g.Label,{x:o-55},a.a.createElement(g.Tag,null),a.a.createElement(g.Text,{text:l,padding:r.statePadding,fontSize:r.stateHeight-r.statePadding,align:"right",wrap:"none",width:55})))}))}},{key:"computeHeight",value:function(){return this.props.node.states.length*this.stateHeight+2*this.stateOffset+this.titleHeight}},{key:"setPosition",value:function(e,t){var n=this.width,r=this.height;this.x=e,this.y=t,this.center={x:e+n/2,y:t+r/2},this.corners={tl:{x:e,y:t},tr:{x:e+n,y:t},bl:{x:e,y:t+r},br:{x:e+n,y:t+r}}}},{key:"render",value:function(){var e=this.props,t=e.node,n=e.query,r=e.probabilities,o=this.x,i=this.y,s=this.width,c=this.height,l=this.createStates(t,r,n);return a.a.createElement(g.Group,{x:o,y:i,width:s,height:c,onDragMove:this.onDragMove,onDragEnd:this.onDragEnd,draggable:!0},a.a.createElement(g.Rect,{fill:"#efefef",width:s,height:c,cornerRadius:5,shadowBlur:5}),a.a.createElement(g.Label,null,a.a.createElement(g.Tag,null),a.a.createElement(g.Text,{text:t.name,padding:4,fontSize:this.titleHeight,fontStyle:"bold",width:s})),l)}}]),t}(r.Component),m=n(41),y=n.n(m),k=new(function(){function e(){Object(s.a)(this,e),this._axios=null}return Object(c.a)(e,[{key:"init",value:function(e){this._axios=y.a.create(e)}},{key:"request",value:function(e){return this._axios.request(e).then((function(e){return e.data}))}},{key:"getVersion",value:function(){return this.request({url:"/version",method:"GET"})}},{key:"getNetworks",value:function(){return this.request({url:"/network",method:"GET"})}},{key:"getNetwork",value:function(e){return this.request({url:"/network/".concat(e),method:"GET"})}},{key:"saveNetwork",value:function(e,t){return this.request({url:"/network/".concat(e),method:"POST",data:t})}},{key:"queryNetwork",value:function(e,t){return this.request({url:"/network/".concat(e,"/_query"),params:t,method:"GET"})}}]),e}());n(118);function w(e){var t=e.src,n=e.dst;return a.a.createElement(g.Arrow,{x:0,y:0,points:[t.x,t.y,n.x,n.y],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:2})}function b(e){return e.nodes.map((function(e){return e.RV}))}function E(e,t,n,r,a,o,i,s){if(e===n&&t===r||a===i&&o===s)return console.warn("Found line of length 0"),!1;var c=(s-o)*(n-e)-(i-a)*(r-t);if(0===c)return console.warn("Denominator is zero 0"),!1;var l=((i-a)*(t-o)-(s-o)*(e-a))/c,u=((n-e)*(t-o)-(r-t)*(e-a))/c;return!(l<0||l>1||u<0||u>1)&&{x:e+l*(n-e),y:t+l*(r-t)}}function O(e,t){for(var n=!1,r=0,a=[["tl","tr"],["tl","bl"],["tr","br"],["bl","br"]];r<a.length;r++){var o=a[r],i=o[0],s=o[1];if(n=E(e[i].x,e[i].y,e[s].x,e[s].y,t.src.x,t.src.y,t.dst.x,t.dst.y))break}return n||console.warn("Could not determine intersection"),n}var x=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).onNodeMove=function(e,t,r){n.nodeAttrsToState()},n.onNodeMoved=function(e,t,r){var a=Object(p.a)({},n.props.network),o=n.props.network_id,i=!0,s=!1,c=void 0;try{for(var l,u=a.nodes[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var d=l.value;if(d.RV===e){d.position=[t,r];break}}}catch(h){s=!0,c=h}finally{try{i||null==u.return||u.return()}finally{if(s)throw c}}k.saveNetwork(o,a)},n.onStateToggled=function(e,t){var r=Object(p.a)({},n.state.query);r[e]&&r[e]===t?delete r[e]:r[e]=t,n.query(r)},n.state={first_pass_complete:!1,node_centers:{},node_corners:{},query:{},probabilities:{}},n.myRefs={},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.nodeAttrsToState(),this.query({})}},{key:"query",value:function(e){var t=this,n=this.props.network.id;k.queryNetwork(n,e).then((function(e){t.setState({query:e.query,probabilities:e.probabilities})}))}},{key:"nodeAttrsToState",value:function(){var e=b(this.props.network),t={},n={},r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value,l=this.myRefs[c].current;t[c]=l.center,n[c]=l.corners}}catch(u){a=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}this.setState({first_pass_complete:!0,node_centers:t,node_corners:n})}},{key:"computeEdge",value:function(e,t){var n=this.state,r=n.node_centers,a=n.node_corners,o=r[e],i=r[t],s=a[e],c=a[t];return{src:O(s,{src:o,dst:i}),dst:O(c,{src:o,dst:i})}}},{key:"renderEdges",value:function(){var e=this;return this.props.network.edges.map((function(t){var n=t[0],r=t[1],o=e.computeEdge(n,r),i=o.src,s=o.dst;return a.a.createElement(w,{key:"".concat(n,"_").concat(r),src:i,dst:s})}))}},{key:"render",value:function(){var e=this,t=this.props.network,n=this.state,r=n.first_pass_complete,o=n.query,i=n.probabilities,s=this.myRefs,c=b(t),l=t.nodes.reduce((function(e,t){return e[t.RV]=t,e}),{});return a.a.createElement("div",{className:"Network"},a.a.createElement("div",{className:"KonvaContainer"},a.a.createElement(g.Stage,{width:2042,height:1024},a.a.createElement(g.Layer,null,r&&this.renderEdges(),c.map((function(t){return s[t]=a.a.createRef(),a.a.createElement(v,{ref:s[t],key:t,node:l[t],query:o[t],probabilities:i[t],onDragMove:e.onNodeMove,onDragEnd:e.onNodeMoved,onStateToggled:e.onStateToggled})}))))))}}]),t}(r.Component);n(119);function j(e){return null}var N=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).onNetworkSelected=function(e){console.log("network ".concat(e," selected!")),k.getNetwork(e).then((function(t){var r=t.json;r.id=e,n.setState({network_id:e,network:r})}))},n.state={networks:[],network:null},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;k.getNetworks().then((function(t){t.length>0&&e.setState({networks:t},(function(){return e.onNetworkSelected(t[0].id)}))}))}},{key:"render",value:function(){var e=this.state,t=e.networks,n=e.network_id,r=e.network;return a.a.createElement("div",{className:"App"},a.a.createElement(j,null,"Header that displays "),a.a.createElement(h,{networks:t,onNetworkSelected:this.onNetworkSelected}),null===r&&a.a.createElement("span",null,"Loading ..."),r&&a.a.createElement(x,{key:r.id,network_id:n,network:r}),a.a.createElement(f,null))}}]),t}(r.Component),S={baseURL:""};Object({NODE_ENV:"production",PUBLIC_URL:"/static"}).REACT_APP_BASEURL&&(S.baseURL=Object({NODE_ENV:"production",PUBLIC_URL:"/static"}).REACT_APP_BASEURL);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));k.init(S),i.a.render(a.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},42:function(e,t,n){e.exports=n(120)},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){}},[[42,1,2]]]);
//# sourceMappingURL=main.2cd62afb.chunk.js.map